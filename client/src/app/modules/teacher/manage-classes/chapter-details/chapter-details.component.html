<div class="flex min-w-0 flex-auto flex-col bg-gray-100 sm:absolute sm:inset-0 dark:bg-transparent">
    <!-- Header -->
    <div class="relative flex flex-0 flex-col px-6 py-6 sm:flex-row sm:items-center sm:justify-between md:px-8">
        <div class="min-w-0 flex-1">
            <!-- Title -->
            <div class="text-4xl font-extrabold tracking-tight">
                {{ selectedChapter.name }}
            </div>
            <div class="text-secondary text-xl">
                {{ 'classes.chapter_details_page_subtext' | transloco }}
            </div>
        </div>
    </div>

    <div class="-mt-px flex-auto p-4 pt-0 sm:p-6 overflow-y-auto">
        <div class="bg-card flex flex-auto flex-col overflow-hidden rounded-2xl p-6 shadow mb-4">
            <div class="flex flex-row items-center justify-between">
                <div class="text-2xl font-extrabold leading-none tracking-tight">
                    Chapter Status

                </div>
                <div>
                    <mat-form-field class="min-w-50" [subscriptSizing]="'dynamic'" floatLabel="always">
                        <mat-select [(ngModel)]="chapterStatus">
                            <mat-option value="in-progress">{{
                                'classes.status_in_progress' | transloco
                                }}</mat-option>
                            <mat-option value="completed">{{
                                'classes.status_completed' | transloco
                                }}</mat-option>
                            <mat-option value="not-started">{{
                                'classes.status_not_started' | transloco
                                }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <mat-tab-group class="mt-4">
                <mat-tab label="{{ 'chapters.tab_lesson_plan' | transloco}}">
                    <div class="mt-4 px-2 pb-2">
                        <mat-accordion class="space-y-4"> <!-- multi -->
                            <mat-expansion-panel *ngFor="let phase of selectedChapter?.lessonPlan; let index = index">
                                <mat-expansion-panel-header>
                                    <mat-panel-title class="text-2xl">
                                        Phase {{ (index + 1) + ' - ' + phase.label
                                        }}
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="p-2 flex flex-col gap-2">

                                    <div class="w-full" (copy)="$event.preventDefault()"
                                        (contextmenu)="$event.preventDefault()">
                                        <quill-view [content]="phase.content ?? 'No content available'" class="no-copy"
                                            format="html" theme="snow" [sanitize]="true"></quill-view>
                                    </div>
                                </div>
                            </mat-expansion-panel>
                        </mat-accordion>
                    </div>

                </mat-tab>

                <mat-tab label="{{ 'chapters.tab_text_book' | transloco}}">
                    <div class="mt-4 flex flex-col gap-2">

                        <!-- Uploaded Files Preview -->
                        <div class="mt-6 grid grid-cols-1 md:grid-cols-4 lg:grid-cols-5 gap-4">
                            <div *ngFor="let file of selectedChapter.textBook; let i = index"
                                class="bg-gray-100 p-4 rounded-lg flex flex-col items-start gap-2 relative">
                                <div class="w-full flex justify-between items-center">
                                    <div class="text-lg text-gray-600 font-semibold"> {{
                                        file.name.split('.').pop()?.toUpperCase() }}</div>
                                    <div>
                                        <button mat-icon-button color="primary"
                                            matTooltip="{{ 'chapters.button_preview_file' | transloco}}"
                                            class="bg-white rounded-full shadow-sm" (click)="previewFile(file)">
                                            <mat-icon [svgIcon]="'heroicons_outline:eye'"></mat-icon>
                                        </button>
                                        <button mat-icon-button color="warn" (click)="removeFile(chapter, i, 1)"
                                            matTooltip="{{ 'chapters.button_delete_file' | transloco}}"
                                            class="bg-white rounded-full shadow-sm ml-2">
                                            <mat-icon [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                        </button>
                                    </div>
                                </div>
                                <div class="text-sm text-gray-800 break-words w-full truncate">{{
                                    file.name }}</div>
                            </div>
                        </div>
                    </div>
                </mat-tab>

                <mat-tab label="{{ 'chapters.tab_reference_materials' | transloco}}">
                    <div class="mt-4 flex flex-col gap-2">

                        <div class="w-full border-2 border-dashed border-blue-500 rounded-lg p-5 text-center cursor-pointer transition hover:bg-blue-50"
                            (drop)="onFileDrop(selectedChapter, $event, 2)"
                            (dragover)="onDragOver(selectedChapter,$event, 2)"
                            (dragleave)="onDragLeave(selectedChapter,$event, 2)" (click)="fileInput2.click()">
                            <!-- Cloud Upload Icon -->
                            <div class="flex flex-col items-center justify-center">
                                <mat-icon class="icon-size-10 text-gray-400"
                                    svgIcon="mat_outline:cloud_upload"></mat-icon>
                                <div class="mt-3 text-base text-gray-700 font-medium">{{
                                    'chapters.upload_drag_drop' | transloco}}</div>
                                <div class="text-sm text-blue-500 font-medium">{{
                                    'chapters.upload_browse' | transloco}}</div>
                            </div>
                            <input type="file" #fileInput2 hidden multiple
                                (change)="onFileSelected(selectedChapter,$event, 2)"
                                accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.odt,.jpg,.jpeg,.png,.gif,.svg,.webp,.mp4,.mkv,.mp3,.wav,.avi,.mov,.wmv,.flv" />
                        </div>



                        <!-- Uploaded Files Preview -->
                        <div class="mt-6 grid grid-cols-1 md:grid-cols-4 lg:grid-cols-5 gap-4">
                            <div *ngFor="let file of selectedChapter.referenceMaterials; let i = index"
                                class="bg-gray-100 p-4 rounded-lg flex flex-col items-start gap-2 relative">
                                <div class="w-full flex justify-between items-center">
                                    <div class="text-lg text-gray-600 font-semibold"> {{
                                        file.name.split('.').pop()?.toUpperCase() }}</div>
                                    <div>
                                        <button mat-icon-button color="primary"
                                            matTooltip="{{ 'chapters.button_preview_file' | transloco}}"
                                            class="bg-white rounded-full shadow-sm" (click)="previewFile(file)">
                                            <mat-icon [svgIcon]="'heroicons_outline:eye'"></mat-icon>
                                        </button>
                                        <button mat-icon-button color="warn" (click)="removeFile(chapter, i, 2)"
                                            matTooltip="{{ 'chapters.button_delete_file' | transloco}}"
                                            class="bg-white rounded-full shadow-sm ml-2">
                                            <mat-icon [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                        </button>
                                    </div>

                                </div>
                                <div class="text-sm text-gray-800 break-words w-full truncate">{{
                                    file.name }}</div>
                            </div>
                        </div>
                    </div>
                </mat-tab>
            </mat-tab-group>
        </div>
    </div>
</div>